<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhotoNest 登录</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #f2f6fd;
  --panel: rgba(255,255,255,.76);
  --line: rgba(16, 29, 53, .1);
  --text: #10203b;
  --muted: #6a7b98;
  --accent: #0a84ff;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  min-height: 100vh;
  font-family: "Outfit", "Noto Sans SC", sans-serif;
  color: var(--text);
  background:
    radial-gradient(900px 450px at 0% 0%, #d7ebff 0%, transparent 60%),
    radial-gradient(900px 450px at 100% 100%, #d6f8e9 0%, transparent 60%),
    linear-gradient(180deg, #f8faff 0%, #eef4fd 100%);
  display: grid;
  place-items: center;
  padding: 20px;
}
.panel {
  width: min(430px, 92vw);
  border-radius: 26px;
  border: 1px solid var(--line);
  background: var(--panel);
  backdrop-filter: blur(16px) saturate(1.15);
  box-shadow: 0 24px 62px rgba(15, 32, 68, 0.16);
  padding: 30px;
}
.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 14px;
}
.logo {
  width: 44px;
  height: 44px;
  border-radius: 13px;
  box-shadow: 0 10px 20px rgba(10, 132, 255, .26);
}
h1 {
  margin: 0;
  font-size: 24px;
  letter-spacing: -0.02em;
}
.sub {
  margin: 0 0 22px;
  color: var(--muted);
  font-size: 13px;
}
.field { margin-bottom: 13px; }
label {
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
}
input {
  width: 100%;
  height: 46px;
  border-radius: 13px;
  border: 1px solid var(--line);
  background: rgba(255, 255, 255, .9);
  padding: 0 13px;
  font-size: 14px;
  font-family: inherit;
  outline: none;
}
input:focus {
  border-color: rgba(10, 132, 255, .4);
  box-shadow: 0 0 0 4px rgba(10, 132, 255, .12);
}
button {
  width: 100%;
  height: 46px;
  border: none;
  border-radius: 13px;
  background: linear-gradient(180deg, #2795ff, #0a84ff);
  color: white;
  font-size: 14px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  margin-top: 4px;
}
button:hover { filter: brightness(1.02); }
#error {
  min-height: 20px;
  margin-top: 11px;
  color: #ef4444;
  font-size: 12px;
}
</style>
</head>
<body>
  <div class="panel">
    <div class="brand">
      <img class="logo" src="/static/photonest-logo.svg" alt="PhotoNest logo">
      <div>
        <h1>PhotoNest</h1>
      </div>
    </div>
    <p class="sub">登录后浏览管理员发布并授权的私人相册。</p>

    <form id="login-form">
      <div class="field">
        <label for="username">账号</label>
        <input id="username" name="username" autocomplete="username" required>
      </div>
      <div class="field">
        <label for="password">密码</label>
        <input id="password" name="password" type="password" autocomplete="current-password" required>
      </div>
      <button type="submit">登录</button>
      <div id="error"></div>
    </form>
  </div>

<script>
const NEXT_URL = {{ next_url | tojson }};

async function login(username, password) {
  const res = await fetch('/api/auth/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password, next: NEXT_URL })
  });

  if (!res.ok) {
    throw new Error('账号或密码错误');
  }

  const data = await res.json();
  window.location.href = data.next || '/';
}

document.getElementById('login-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const error = document.getElementById('error');
  error.textContent = '';

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;

  try {
    await login(username, password);
  } catch (err) {
    error.textContent = err.message || '登录失败';
  }
});
</script>
</body>
</html>
